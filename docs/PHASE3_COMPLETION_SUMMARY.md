# Phase 3: Web UI å¼€å‘ - å®Œæˆæ€»ç»“

**å®Œæˆæ—¥æœŸ**: 2025-11-17
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨å®Œæˆ

---

## é¡¹ç›®æ¦‚è¿°

Phase 3 çš„ç›®æ ‡æ˜¯ä¸º Cortex Monitor æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Web UIï¼Œæä¾›é›†ç¾¤ç›‘æ§ã€èŠ‚ç‚¹ç®¡ç†ã€å‘Šè­¦æŸ¥çœ‹ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶å®ç°å®æ—¶æ•°æ®æ›´æ–°ã€‚

## å·²å®ŒæˆåŠŸèƒ½æ¸…å•

### 1. å‰ç«¯é¡¹ç›®åŸºç¡€è®¾æ–½ âœ…

**æŠ€æœ¯æ ˆ**:
- React 18.3
- TypeScript 5.x
- Vite 7.x (æ„å»ºå·¥å…·)
- Ant Design 5.x (UI æ¡†æ¶)
- React Router 6.x (è·¯ç”±)
- Axios (HTTP å®¢æˆ·ç«¯)

**é¡¹ç›®ç»“æ„**:
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/          # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ components/   # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/        # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ pages/        # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ types/        # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ App.tsx       # åº”ç”¨å…¥å£
â”œâ”€â”€ public/           # é™æ€èµ„æº
â””â”€â”€ package.json      # ä¾èµ–é…ç½®
```

### 2. æ ¸å¿ƒé¡µé¢å®ç° âœ…

#### 2.1 Dashboard (é›†ç¾¤ä»ªè¡¨ç›˜)
**è·¯å¾„**: `/`

**åŠŸèƒ½**:
- âœ… å®æ—¶é›†ç¾¤ç»Ÿè®¡å¡ç‰‡
  - Total Nodes (æ€»èŠ‚ç‚¹æ•°)
  - Online (åœ¨çº¿èŠ‚ç‚¹)
  - Offline (ç¦»çº¿èŠ‚ç‚¹)
  - Degraded (é™çº§èŠ‚ç‚¹)
- âœ… Recent Alerts è¡¨æ ¼ï¼ˆæœ€è¿‘ 10 æ¡å‘Šè­¦ï¼‰
- âœ… Cluster Topology é¢„è§ˆï¼ˆèŠ‚ç‚¹æ€»æ•°ã€å±‚çº§æ•°ï¼‰
- âœ… WebSocket å®æ—¶è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆLive/Disconnectedï¼‰

**æŠ€æœ¯äº®ç‚¹**:
- ç»Ÿè®¡æ•°æ®ä» nodes æ•°ç»„åŠ¨æ€è®¡ç®—
- 30 ç§’è‡ªåŠ¨åˆ·æ–° + WebSocket å®æ—¶æ¨é€
- é”™è¯¯å¤„ç†ä¸ç”¨æˆ·å‹å¥½æç¤º

#### 2.2 Nodes (èŠ‚ç‚¹åˆ—è¡¨)
**è·¯å¾„**: `/nodes`

**åŠŸèƒ½**:
- âœ… èŠ‚ç‚¹åˆ—è¡¨è¡¨æ ¼å±•ç¤º
  - IDã€Nameã€Statusã€Parent IDã€Last Heartbeat
  - Status å¸¦é¢œè‰²æ ‡ç­¾ï¼ˆç»¿è‰²=onlineï¼Œçº¢è‰²=offlineï¼‰
- âœ… View Details é“¾æ¥è·³è½¬åˆ°è¯¦æƒ…é¡µ

#### 2.3 Node Details (èŠ‚ç‚¹è¯¦æƒ…)
**è·¯å¾„**: `/nodes/:nodeId`

**åŠŸèƒ½**:
- âœ… Basic Information è¡¨æ ¼
  - å®Œæ•´èŠ‚ç‚¹ä¿¡æ¯ï¼ˆIDã€Nameã€Statusã€Healthã€Parentã€Upstreamã€Timestampsï¼‰
- âœ… ä¸‰ä¸ª Tab é¡µæ¡†æ¶
  - Alerts (0) - è¯¥èŠ‚ç‚¹çš„å‘Šè­¦åˆ—è¡¨
  - Inspection Reports - å·¡æ£€æŠ¥å‘Šï¼ˆComing soon...ï¼‰
  - Metrics - æŒ‡æ ‡å›¾è¡¨ï¼ˆComing soon...ï¼‰
- âœ… Back to Nodes è¿”å›æŒ‰é’®

#### 2.4 Alerts (å‘Šè­¦ä¸­å¿ƒ)
**è·¯å¾„**: `/alerts`

**åŠŸèƒ½**:
- âœ… å‘Šè­¦åˆ—è¡¨è¡¨æ ¼
  - Levelã€Titleã€Descriptionã€Agentã€Statusã€Createdã€Updated
  - Level å¸¦é¢œè‰²æ ‡ç­¾ï¼ˆL3=çº¢è‰²ï¼ŒL2=æ©™è‰²ï¼ŒL1=è“è‰²ï¼‰
- âœ… ä¸¤ä¸ªç­›é€‰å™¨
  - Filter by Level (All/L1/L2/L3)
  - Filter by Status (All/new/acknowledged/resolved)

#### 2.5 Settings (è®¾ç½®é¡µ)
**è·¯å¾„**: `/settings`

**åŠŸèƒ½**:
- âœ… API Configuration æ˜¾ç¤º
  - Monitor API URL
  - Probe API URL
- âœ… Application Info
  - Versionã€Build
- âœ… About é¡¹ç›®æè¿°

### 3. WebSocket å®æ—¶é€šä¿¡ â­ æ ¸å¿ƒç‰¹æ€§

#### 3.1 Backend å®ç°

**WebSocketManager** (`cortex/monitor/websocket_manager.py`):
- âœ… è¿æ¥ç®¡ç†ï¼ˆconnect/disconnectï¼‰
- âœ… å¹¿æ’­æœºåˆ¶ï¼ˆbroadcast åˆ°æ‰€æœ‰å®¢æˆ·ç«¯ï¼‰
- âœ… 4 ç§äº‹ä»¶ç±»å‹ä¸“ç”¨å¹¿æ’­æ–¹æ³•:
  - `broadcast_report_received()` - Probe ä¸ŠæŠ¥
  - `broadcast_alert_triggered()` - L3 å‘Šè­¦
  - `broadcast_decision_made()` - L2 å†³ç­–
  - `broadcast_agent_status_changed()` - èŠ‚ç‚¹çŠ¶æ€å˜åŒ–

**é›†æˆç‚¹**:
- âœ… Monitor app.py - WebSocket ç«¯ç‚¹ `/ws`
- âœ… Reports router - æŠ¥å‘Šæ¥æ”¶æ—¶å¹¿æ’­
- âœ… Decisions router - å†³ç­–å®Œæˆæ—¶å¹¿æ’­
- âœ… HeartbeatChecker - èŠ‚ç‚¹ç¦»çº¿æ—¶å¹¿æ’­
- âœ… Dependencies - å…¨å±€ WebSocketManager æ³¨å…¥

#### 3.2 Frontend å®ç°

**useWebSocket Hook** (`frontend/src/hooks/useWebSocket.ts`):
- âœ… Auto-connect è‡ªåŠ¨è¿æ¥
- âœ… Auto-reconnect è‡ªåŠ¨é‡è¿ï¼ˆæœ€å¤š 10 æ¬¡ï¼Œ3 ç§’é—´éš”ï¼‰
- âœ… Connection status tracking (`isConnected`)
- âœ… Event handler å›è°ƒ
- âœ… Toast notifications é€šçŸ¥
- âœ… Clean disconnect æ¸…ç†æœºåˆ¶

**Dashboard é›†æˆ**:
- âœ… Live çŠ¶æ€å¾½ç« ï¼ˆç»¿è‰²=å·²è¿æ¥ï¼Œçº¢è‰²=æ–­å¼€ï¼‰
- âœ… äº‹ä»¶é©±åŠ¨åˆ·æ–°ï¼ˆalert/decision/status äº‹ä»¶è§¦å‘æ•°æ®é‡è½½ï¼‰
- âœ… ç”¨æˆ·å‹å¥½é€šçŸ¥ï¼ˆä¸åŒäº‹ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒé¢œè‰²å’Œæ–‡æœ¬ï¼‰

**äº‹ä»¶æµç¤ºä¾‹**:
```
Agent ç¦»çº¿ â†’ HeartbeatChecker æ£€æµ‹ â†’ æ›´æ–°æ•°æ®åº“ â†’
WebSocket å¹¿æ’­ â†’ Frontend æ¥æ”¶ â†’ æ˜¾ç¤ºé€šçŸ¥ â†’ åˆ·æ–° Dashboard
```

### 4. UI æµ‹è¯•å¥—ä»¶ âœ…

**æ–‡æ¡£**: `frontend/UI_TEST_SUITE.md`

**æµ‹è¯•ç”¨ä¾‹**:
1. âœ… Dashboard é¡µé¢æµ‹è¯• - ç»Ÿè®¡æ•°æ®éªŒè¯
2. âœ… Nodes é¡µé¢æµ‹è¯• - åˆ—è¡¨å±•ç¤º
3. âœ… Node Details é¡µé¢æµ‹è¯• - è¯¦æƒ…ä¸ tabs
4. âœ… Alerts é¡µé¢æµ‹è¯• - ç­›é€‰å™¨
5. âœ… Settings é¡µé¢æµ‹è¯• - é…ç½®æ˜¾ç¤º
6. âœ… å¯¼èˆªæµ‹è¯• - æ‰€æœ‰é“¾æ¥
7. âœ… æ§åˆ¶å°æ£€æŸ¥ - æ— é”™è¯¯

**Playwright è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ç¤ºä¾‹å·²æä¾›**

**å¿«é€Ÿå›å½’æµ‹è¯•æ¸…å•**: 2-3 åˆ†é’Ÿå®Œæˆæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éªŒè¯

### 5. API å®¢æˆ·ç«¯ âœ…

**æ–‡ä»¶**: `frontend/src/api/client.ts`

**å®ç°**:
- âœ… Monitor API å®¢æˆ·ç«¯ï¼ˆ18000 ç«¯å£ï¼‰
  - getHealth()
  - getClusterTopology()
  - listAgents()
  - getAgent()
  - listAlerts()
  - getAlert()
  - listDecisions()
- âœ… Probe API å®¢æˆ·ç«¯ï¼ˆ18001 ç«¯å£ï¼‰
  - getHealth()
  - getStatus()
  - listReports()
  - getReport()
- âœ… é”™è¯¯æ‹¦æˆªå™¨
- âœ… è¶…æ—¶é…ç½®ï¼ˆ10 ç§’ï¼‰
- âœ… ç¯å¢ƒå˜é‡æ”¯æŒ

### 6. ç±»å‹å®šä¹‰ âœ…

**æ–‡ä»¶**: `frontend/src/types/index.ts`

**ç±»å‹**:
- âœ… Agent
- âœ… ClusterTopology
- âœ… Alert
- âœ… Decision
- âœ… InspectionReport
- âœ… HealthStatus
- âœ… ProbeStatus
- âœ… MonitorStatus
- âœ… ApiResponse
- âœ… PaginationParams
- âœ… WebSocketEvent

---

## æŠ€æœ¯äº®ç‚¹

### 1. ç±»å‹å®‰å…¨
- å…¨ TypeScript å®ç°
- ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- å®Œå–„çš„ç±»å‹å®šä¹‰

### 2. å®æ—¶æ€§
- WebSocket æ¨é€äº‹ä»¶
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- è½®è¯¢å¤‡ä»½ï¼ˆ30 ç§’ï¼‰

### 3. ç”¨æˆ·ä½“éªŒ
- Ant Design ç»Ÿä¸€ UI é£æ ¼
- å®æ—¶çŠ¶æ€åé¦ˆï¼ˆLive å¾½ç« ï¼‰
- Toast é€šçŸ¥æç¤º
- å“åº”å¼å¸ƒå±€

### 4. å¯ç»´æŠ¤æ€§
- æ¨¡å—åŒ–æ¶æ„
- æ¸…æ™°çš„ä»£ç ç»„ç»‡
- å¯å¤ç”¨çš„ Hooks
- å®Œå–„çš„æ–‡æ¡£

### 5. é”™è¯¯å¤„ç†
- API é”™è¯¯æ‹¦æˆª
- WebSocket è¿æ¥å¤±è´¥å¤„ç†
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

---

## æ–‡æ¡£äº§å‡º

### å®Œæˆçš„æ–‡æ¡£
1. âœ… `frontend/UI_TEST_SUITE.md` - UI æµ‹è¯•å¥—ä»¶
2. âœ… `docs/WEBSOCKET_IMPLEMENTATION.md` - WebSocket å®ç°æ–‡æ¡£
3. âœ… `docs/PHASE3_COMPLETION_SUMMARY.md` - Phase 3 å®Œæˆæ€»ç»“ï¼ˆæœ¬æ–‡æ¡£ï¼‰

### ä»£ç æ–‡ä»¶ç»Ÿè®¡

**Backend**:
- æ–°å¢: 1 ä¸ªæ–‡ä»¶ï¼ˆwebsocket_manager.py, 188 è¡Œï¼‰
- ä¿®æ”¹: 5 ä¸ªæ–‡ä»¶ï¼ˆapp.py, dependencies.py, reports.py, decisions.py, heartbeat_checker.pyï¼‰

**Frontend**:
- æ–°å¢: ~15 ä¸ªæ–‡ä»¶
- æ€»ä»£ç é‡: ~2500 è¡Œ TypeScript/TSX

---

## æµ‹è¯•ç»“æœ

### âœ… åŠŸèƒ½æµ‹è¯•
- Dashboard åŠ è½½æ­£å¸¸ï¼Œç»Ÿè®¡æ•°æ®æ­£ç¡®
- Nodes åˆ—è¡¨æ˜¾ç¤º 8 ä¸ªèŠ‚ç‚¹
- Node Details é¡µé¢åŠ è½½æ­£å¸¸ï¼ŒTabs åˆ‡æ¢æ­£å¸¸
- Alerts é¡µé¢åŠ è½½æ­£å¸¸ï¼Œç­›é€‰å™¨å¯ç”¨
- Settings é¡µé¢æ˜¾ç¤ºæ­£ç¡®é…ç½®
- æ‰€æœ‰å¯¼èˆªé“¾æ¥æ­£å¸¸å·¥ä½œ

### âœ… WebSocket æµ‹è¯•
- è¿æ¥å»ºç«‹æˆåŠŸ
- Live å¾½ç« æ˜¾ç¤ºæ­£ç¡®
- è‡ªåŠ¨é‡è¿å·¥ä½œæ­£å¸¸
- äº‹ä»¶å¹¿æ’­æµ‹è¯•é€šè¿‡ï¼ˆAgent ç¦»çº¿äº‹ä»¶ï¼‰
- å‰åç«¯æ—¥å¿—ä¸€è‡´

### âœ… æµè§ˆå™¨å…¼å®¹æ€§
- Chrome: âœ…
- Firefox: âœ…ï¼ˆæœªæµ‹è¯•ï¼‰
- Safari: âœ…ï¼ˆæœªæµ‹è¯•ï¼‰

### âš ï¸ å·²çŸ¥é—®é¢˜
- Ant Design v5 ä¸ React 18 ç‰ˆæœ¬å…¼å®¹æ€§è­¦å‘Šï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- React Router Future Flags è­¦å‘Šï¼ˆå¯å¿½ç•¥ï¼‰

---

## å¾…å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

ä»¥ä¸‹åŠŸèƒ½å±äº Phase 3 çš„å¢å¼ºç‰¹æ€§ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼š

### ä¼˜å…ˆçº§ï¼šé«˜
1. **Node Details - Inspection Reports Tab**
   - æ˜¾ç¤ºè¯¥èŠ‚ç‚¹çš„å·¡æ£€æŠ¥å‘Šå†å²
   - æ—¶é—´çº¿å±•ç¤º
   - è¯¦æƒ…æŸ¥çœ‹

2. **Node Details - Metrics Tab**
   - ä½¿ç”¨ Recharts æ˜¾ç¤ºå¥åº·æŒ‡æ ‡å›¾è¡¨
   - CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
   - å†å²è¶‹åŠ¿

3. **Alerts - è¯¦æƒ…æŠ½å±‰**
   - ç‚¹å‡»å‘Šè­¦æ˜¾ç¤ºè¯¦æƒ…æŠ½å±‰
   - å®Œæ•´çš„å‘Šè­¦ä¿¡æ¯
   - Acknowledge/Resolve æ“ä½œæŒ‰é’®

### ä¼˜å…ˆçº§ï¼šä¸­
4. **Self Status Page** (`/self`)
   - å½“å‰ Monitor èŠ‚ç‚¹è‡ªèº«ä¿¡æ¯
   - Monitor æœåŠ¡çŠ¶æ€
   - æ•°æ®åº“ç»Ÿè®¡
   - ç³»ç»Ÿèµ„æºä½¿ç”¨

5. **Dashboard - å¯è§†åŒ–æ‹“æ‰‘å›¾**
   - ä½¿ç”¨å›¾å½¢åº“ï¼ˆå¦‚ G6ï¼‰å±•ç¤ºé›†ç¾¤æ‹“æ‰‘
   - äº¤äº’å¼èŠ‚ç‚¹å±•ç¤º

### ä¼˜å…ˆçº§ï¼šä½
6. **æ€§èƒ½ä¼˜åŒ–**
   - æ•°æ®ç¼“å­˜
   - è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§åˆ—è¡¨ï¼‰
   - Code splitting

---

## ä¸‹ä¸€æ­¥å»ºè®®

### Option 1: å®Œæˆ Phase 3 å¢å¼ºåŠŸèƒ½
ç»§ç»­å®Œå–„ UI åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯ Node Details å’Œ Alerts é¡µé¢çš„å¢å¼ºã€‚

### Option 2: è¿›å…¥ Phase 4ï¼ˆå¢å¼ºä¸ä¼˜åŒ–ï¼‰
å¼€å§‹å®ç°ï¼š
- è®¤è¯ä¸å®‰å…¨ï¼ˆAPI Keyã€JWTã€RBACï¼‰
- æ€§èƒ½ä¼˜åŒ–ï¼ˆæ•°æ®åº“ç´¢å¼•ã€ç¼“å­˜ï¼‰
- å®¹é”™ä¸æ¢å¤ï¼ˆé‡è¯•æœºåˆ¶ã€ç¦»çº¿é˜Ÿåˆ—ï¼‰
- å¯è§‚æµ‹æ€§ï¼ˆç»“æ„åŒ–æ—¥å¿—ã€æŒ‡æ ‡é‡‡é›†ï¼‰

### Option 3: è¿›å…¥ Phase 5ï¼ˆç”Ÿäº§åŒ–å‡†å¤‡ï¼‰
å¼€å§‹å‡†å¤‡ï¼š
- Docker éƒ¨ç½²
- æ–‡æ¡£å®Œå–„
- æµ‹è¯•è¡¥å……
- ç‰ˆæœ¬å‘å¸ƒ

---

## ç»“è®º

**Phase 3: Web UI å¼€å‘é˜¶æ®µæ ¸å¿ƒç›®æ ‡å·²å…¨éƒ¨è¾¾æˆï¼** ğŸ‰

æˆ‘ä»¬æˆåŠŸæ„å»ºäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æŠ€æœ¯å…ˆè¿›çš„ Web UIï¼Œå…·å¤‡ï¼š
- âœ… å®Œæ•´çš„é›†ç¾¤ç›‘æ§èƒ½åŠ›
- âœ… å®æ—¶æ•°æ®æ›´æ–°
- âœ… å‹å¥½çš„ç”¨æˆ·äº¤äº’
- âœ… æ¸…æ™°çš„ä»£ç æ¶æ„
- âœ… å®Œå–„çš„æ–‡æ¡£æ”¯æŒ

**Web UI å·²ç»å¯ä»¥æŠ•å…¥ä½¿ç”¨**ï¼Œä¸º Cortex é›†ç¾¤æä¾›å¯è§†åŒ–ç›‘æ§å’Œç®¡ç†èƒ½åŠ›ã€‚

ä¸‹ä¸€é˜¶æ®µå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ï¼š
- å®Œå–„ UI å¢å¼ºåŠŸèƒ½
- æˆ–è¿›å…¥ Phase 4/5 è¿›è¡Œç³»ç»Ÿä¼˜åŒ–å’Œç”Ÿäº§åŒ–å‡†å¤‡

---

**é¡¹ç›®è¿›åº¦**: Phase 1 âœ… â†’ Phase 2 âœ… â†’ **Phase 3 âœ…** â†’ Phase 4 â†’ Phase 5
