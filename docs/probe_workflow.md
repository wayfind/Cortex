# Probe å·¥ä½œæµç¨‹è¯¦è§£

> æ·±å…¥ç†è§£ Cortex Probe å¦‚ä½•é€šè¿‡æ–‡æ¡£é©±åŠ¨çš„æ–¹å¼å®ç°æ™ºèƒ½å·¡æ£€

## ç›®å½•

- [æ€»ä½“æ¶æ„](#æ€»ä½“æ¶æ„)
- [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
- [è¯¦ç»†æ­¥éª¤](#è¯¦ç»†æ­¥éª¤)
- [æ ¸å¿ƒè®¾è®¡åŸç†](#æ ¸å¿ƒè®¾è®¡åŸç†)
- [å®é™…æ¡ˆä¾‹](#å®é™…æ¡ˆä¾‹)
- [ä¸ä¼ ç»Ÿç›‘æ§å¯¹æ¯”](#ä¸ä¼ ç»Ÿç›‘æ§å¯¹æ¯”)

---

## æ€»ä½“æ¶æ„

### Probe çš„æœ¬è´¨

> **Probe æ˜¯ä¸€ä¸ªç”±æ–‡æ¡£é©±åŠ¨ã€LLM æ‰§è¡Œçš„æ™ºèƒ½è¿ç»´ Agent**ï¼Œèƒ½å¤Ÿè‡ªä¸»å·¡æ£€ã€åˆ†çº§é—®é¢˜ã€è‡ªåŠ¨ä¿®å¤ï¼Œå¹¶ä¸ä¸Šçº§ Monitor ååŒå·¥ä½œã€‚

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Cron å®šæ—¶è§¦å‘                         â”‚
â”‚                     (ä¾‹å¦‚ï¼šæ¯å°æ—¶ä¸€æ¬¡)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    run_probe.sh                              â”‚
â”‚  1. æ£€æŸ¥ä¾èµ– (claude, python3)                                â”‚
â”‚  2. å‡†å¤‡å·¥ä½œç›®å½• (output/)                                     â”‚
â”‚  3. æ„å»ºæç¤ºè¯                                                 â”‚
â”‚  4. è°ƒç”¨ claude -p                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Claude Code (claude -p)                         â”‚
â”‚                                                              â”‚
â”‚  è¿è¡Œç¯å¢ƒï¼šprobe_workspace/                                   â”‚
â”‚  æ¨¡å¼ï¼š--dangerously-skip-permissions (è‡ªåŠ¨åŒ–)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LLM ç†è§£ä»»åŠ¡å’Œä¸Šä¸‹æ–‡                                â”‚
â”‚                                                              â”‚
â”‚  è¯»å–ï¼š                                                       â”‚
â”‚  - CLAUDE.md (è§’è‰²å®šä¹‰ã€å·¥ä½œæµç¨‹)                             â”‚
â”‚  - inspections/*.md (4ä¸ªå·¡æ£€è¦æ±‚)                            â”‚
â”‚  - tools/ (å¯ç”¨å·¥å…·åˆ—è¡¨)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ‰§è¡Œå·¡æ£€å¾ªç¯                                     â”‚
â”‚                                                              â”‚
â”‚  For each inspection in inspections/*.md:                   â”‚
â”‚    â”œâ”€ è¿è¡Œå¯¹åº”çš„æ£€æŸ¥å·¥å…·                                      â”‚
â”‚    â”œâ”€ åˆ†æ JSON è¾“å‡º                                         â”‚
â”‚    â”œâ”€ åˆ¤æ–­é—®é¢˜çº§åˆ« (L1/L2/L3)                                â”‚
â”‚    â”œâ”€ L1? æ‰§è¡Œè‡ªåŠ¨ä¿®å¤                                        â”‚
â”‚    â””â”€ æ”¶é›†ç»“æœ                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ç”Ÿæˆå’Œä¸ŠæŠ¥æŠ¥å‘Š                                     â”‚
â”‚                                                              â”‚
â”‚  1. è°ƒç”¨ report_builder.py                                   â”‚
â”‚  2. ç”Ÿæˆ output/report.json                                  â”‚
â”‚  3. (å¯é€‰) è°ƒç”¨ report_to_monitor.py                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monitor API                               â”‚
â”‚                                                              â”‚
â”‚  POST /api/reports                                           â”‚
â”‚  - å­˜å‚¨æŠ¥å‘Š                                                   â”‚
â”‚  - å¤„ç† L2 å†³ç­–                                               â”‚
â”‚  - è§¦å‘ L3 å‘Šè­¦                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·¥ä½œæµç¨‹

### æ‰§è¡Œæ—¶åº

```
æ—¶é—´è½´                    Probe Agent çš„æ‰§è¡Œè¿‡ç¨‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

00:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ run_probe.sh å¯åŠ¨                        â”‚
       â”‚ - æ£€æŸ¥ä¾èµ–                                â”‚
       â”‚ - å‡†å¤‡å·¥ä½œç›®å½•                             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:02                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ claude -p å¯åŠ¨                           â”‚
       â”‚ - åŠ è½½ CLAUDE.md                         â”‚
       â”‚ - ç†è§£è§’è‰²å’Œä»»åŠ¡                          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:05                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å·¡æ£€ 1: ç£ç›˜ç©ºé—´                          â”‚
       â”‚ â”œâ”€ è¯»å– disk_space.md                    â”‚
       â”‚ â”œâ”€ è¿è¡Œ check_disk.py                    â”‚
       â”‚ â”œâ”€ åˆ†æè¾“å‡º: 63.42% â†’ æ­£å¸¸               â”‚
       â”‚ â””â”€ æ— éœ€ä¿®å¤                               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:08                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å·¡æ£€ 2: å†…å­˜ä½¿ç”¨                          â”‚
       â”‚ â”œâ”€ è¯»å– memory.md                        â”‚
       â”‚ â”œâ”€ è¿è¡Œ check_memory.py                  â”‚
       â”‚ â”œâ”€ åˆ†æè¾“å‡º: 22.06% â†’ æ­£å¸¸               â”‚
       â”‚ â””â”€ æ— éœ€ä¿®å¤                               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:11                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å·¡æ£€ 3: CPU è´Ÿè½½                          â”‚
       â”‚ â”œâ”€ è¯»å– cpu.md                           â”‚
       â”‚ â”œâ”€ è¿è¡Œ check_cpu.py                     â”‚
       â”‚ â”œâ”€ åˆ†æè¾“å‡º: 0.86% â†’ æ­£å¸¸                â”‚
       â”‚ â””â”€ æ— éœ€ä¿®å¤                               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:14                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å·¡æ£€ 4: æœåŠ¡çŠ¶æ€                          â”‚
       â”‚ â”œâ”€ è¯»å– services.md                      â”‚
       â”‚ â”œâ”€ è¿è¡Œ check_services.py                â”‚
       â”‚ â”œâ”€ åˆ†æè¾“å‡º: 3/4 active â†’ æ­£å¸¸           â”‚
       â”‚ â””â”€ æ— éœ€ä¿®å¤                               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:17                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ ç”ŸæˆæŠ¥å‘Š                                  â”‚
       â”‚ â”œâ”€ è¿è¡Œ report_builder.py                â”‚
       â”‚ â”œâ”€ èšåˆæ‰€æœ‰ç»“æœ                           â”‚
       â”‚ â”œâ”€ ç¡®å®šçŠ¶æ€: healthy                     â”‚
       â”‚ â””â”€ è¾“å‡º report.json                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:19                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ ä¸ŠæŠ¥åˆ° Monitor (å¯é€‰)                     â”‚
       â”‚ â”œâ”€ è¿è¡Œ report_to_monitor.py             â”‚
       â”‚ â”œâ”€ POST /api/reports                     â”‚
       â”‚ â””â”€ æ¥æ”¶ Monitor å“åº”                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
00:20                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å®Œæˆ                                      â”‚
       â”‚ - é€€å‡ºä»£ç : 0                             â”‚
       â”‚ - æŠ¥å‘Š: output/report.json                â”‚
       â”‚ - æ—¥å¿—: output/probe.log                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¯¦ç»†æ­¥éª¤

### æ­¥éª¤ 1ï¼šCron è§¦å‘

**é…ç½®ç¤ºä¾‹**ï¼š
```bash
# /etc/crontab æˆ– crontab -e
0 * * * * /opt/cortex/probe/run_probe.sh >> /var/log/cortex-probe.log 2>&1
```

**ä½œç”¨**ï¼šæŒ‰è®¡åˆ’è‡ªåŠ¨è§¦å‘å·¡æ£€ï¼ˆä¾‹å¦‚æ¯å°æ—¶ï¼‰

---

### æ­¥éª¤ 2ï¼šrun_probe.sh å¯åŠ¨

**æ ¸å¿ƒä»£ç **ï¼š
```bash
#!/bin/bash

# æ£€æŸ¥ä¾èµ–
check_dependencies() {
    command -v claude &> /dev/null || exit 1
    command -v python3 &> /dev/null || exit 1
}

# å‡†å¤‡å·¥ä½œç›®å½•
prepare_workspace() {
    mkdir -p "$OUTPUT_DIR"
    rm -f "${OUTPUT_DIR}"/*.json
}

# æ‰§è¡Œå·¡æ£€
run_probe() {
    PROMPT="Execute a full system inspection as a Cortex Probe Agent.

Follow these steps:
1. Read CLAUDE.md to understand your role and workflow
2. List all inspection requirements in inspections/*.md
3. For each inspection:
   - Run the corresponding tool in tools/
   - Analyze the results
   - Determine if there are any issues (L1/L2/L3)
   - For L1 issues, execute fixes using available tools
   - Collect all results
4. Use tools/report_builder.py to generate the final report
5. Use tools/report_to_monitor.py to upload the report"

    # è°ƒç”¨ Claude
    claude -p --dangerously-skip-permissions "$PROMPT"
}
```

**èŒè´£**ï¼š
1. âœ… ç¯å¢ƒæ£€æŸ¥ï¼ˆéªŒè¯ `claude` å’Œ `python3`ï¼‰
2. ğŸ“ å‡†å¤‡å·¥ä½œç›®å½•
3. ğŸ“ æ„å»ºæç¤ºè¯
4. ğŸš€ è°ƒç”¨ Claude Code

**å…³é”®å‚æ•°**ï¼š
- `-p`ï¼šprompt modeï¼ˆéäº¤äº’å¼ï¼‰
- `--dangerously-skip-permissions`ï¼šè‡ªåŠ¨æ‰¹å‡†å·¥å…·è°ƒç”¨ï¼ˆé€‚åˆ cronï¼‰

---

### æ­¥éª¤ 3ï¼šClaude ç†è§£ä¸Šä¸‹æ–‡

#### 3.1 è¯»å–è§’è‰²å®šä¹‰

**CLAUDE.md**ï¼š
```markdown
# Cortex Probe Agent

ä½ æ˜¯ä¸€ä¸ª Cortex Probe Agentï¼Œè´Ÿè´£æ‰§è¡Œç³»ç»Ÿå·¡æ£€ä»»åŠ¡å¹¶ç”ŸæˆæŠ¥å‘Šã€‚

## ä½ çš„è§’è‰²

ä½ åœ¨ä¸€ä¸ª Linux/Unix æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œè´Ÿè´£ï¼š
1. æ‰§è¡Œå®šæœŸçš„ç³»ç»Ÿå¥åº·æ£€æŸ¥
2. å‘ç°æ½œåœ¨çš„é—®é¢˜
3. å¯¹ç®€å•é—®é¢˜æ‰§è¡Œè‡ªåŠ¨ä¿®å¤ï¼ˆL1ï¼‰
4. å¯¹å¤æ‚é—®é¢˜ç”Ÿæˆå†³ç­–è¯·æ±‚ï¼ˆL2ï¼‰
5. å¯¹ä¸¥é‡é—®é¢˜ç”Ÿæˆå‘Šè­¦ï¼ˆL3ï¼‰
6. å°†ç»“æœä¸ŠæŠ¥ç»™ Monitor

## é—®é¢˜åˆ†çº§æ ‡å‡†

**L1 - å¯è‡ªåŠ¨ä¿®å¤**ï¼š
- ç£ç›˜ç©ºé—´ä¸è¶³ï¼ˆæ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼‰
- æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼ˆè½®è½¬æ—¥å¿—ï¼‰
- ç¼“å­˜å ç”¨è¿‡å¤šï¼ˆæ¸…ç†ç¼“å­˜ï¼‰

**L2 - éœ€è¦å†³ç­–**ï¼š
- å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼ˆéœ€è¦é‡å¯æœåŠ¡ï¼Ÿï¼‰
- CPU æŒç»­é«˜è´Ÿè½½ï¼ˆéœ€è¦æ‰©å®¹ï¼Ÿï¼‰
- æœåŠ¡å¼‚å¸¸ä½†å¯é‡å¯ï¼ˆé‡å¯æ˜¯å¦å®‰å…¨ï¼Ÿï¼‰

**L3 - ä¸¥é‡é—®é¢˜**ï¼š
- ç£ç›˜æ•…éšœ
- æ•°æ®åº“è¿æ¥å¤±è´¥
- å…³é”®æœåŠ¡æ— æ³•å¯åŠ¨
```

**LLM å­¦åˆ°**ï¼š
- è‡ªå·±çš„è§’è‰²å’ŒèŒè´£
- L1/L2/L3 åˆ†çº§æ ‡å‡†
- å¯ç”¨çš„å·¥å…·æ¸…å•

#### 3.2 æ‰«æå·¡æ£€é¡¹

**å·¡æ£€é¡¹åˆ—è¡¨**ï¼š
```
inspections/
â”œâ”€â”€ disk_space.md    # ç£ç›˜ç©ºé—´å·¡æ£€
â”œâ”€â”€ memory.md        # å†…å­˜ä½¿ç”¨å·¡æ£€
â”œâ”€â”€ cpu.md           # CPU è´Ÿè½½å·¡æ£€
â””â”€â”€ services.md      # æœåŠ¡çŠ¶æ€å·¡æ£€
```

LLM å‘ç° 4 ä¸ªå·¡æ£€ä»»åŠ¡éœ€è¦æ‰§è¡Œã€‚

---

### æ­¥éª¤ 4ï¼šæ‰§è¡Œå·¡æ£€å¾ªç¯

#### ç¤ºä¾‹ï¼šç£ç›˜ç©ºé—´å·¡æ£€

**4.1 è¯»å–å·¡æ£€æ–‡æ¡£**

**disk_space.md**ï¼š
```markdown
# ç£ç›˜ç©ºé—´å·¡æ£€

## å·¡æ£€ç›®æ ‡
ç›‘æ§ç³»ç»Ÿç£ç›˜ä½¿ç”¨ç‡ï¼Œé˜²æ­¢ç£ç›˜ç©ºé—´è€—å°½å¯¼è‡´æœåŠ¡æ•…éšœã€‚

## ä½¿ç”¨çš„å·¥å…·
- `tools/check_disk.py` - æ£€æŸ¥æ‰€æœ‰æŒ‚è½½ç‚¹çš„ç£ç›˜ä½¿ç”¨ç‡

## é˜ˆå€¼å®šä¹‰
| æŒ‡æ ‡ | æ­£å¸¸ | è­¦å‘Š | ä¸¥é‡ |
|------|------|------|------|
| ç£ç›˜ä½¿ç”¨ç‡ | < 80% | 80-90% | > 90% |

## é—®é¢˜åˆ†çº§

### L1 - å¯è‡ªåŠ¨ä¿®å¤
**è§¦å‘æ¡ä»¶**ï¼šç£ç›˜ä½¿ç”¨ç‡ 80-90%ï¼Œå­˜åœ¨å¯å®‰å…¨æ¸…ç†çš„ä¸´æ—¶æ–‡ä»¶
**ä¿®å¤æ–¹æ³•**ï¼š
```bash
find /tmp -type f -atime +7 -delete
find /var/log -name "*.gz" -mtime +30 -delete
apt-get clean
```

### L2 - éœ€è¦å†³ç­–
**è§¦å‘æ¡ä»¶**ï¼šç£ç›˜ä½¿ç”¨ç‡ > 90%ï¼ŒL1 æ¸…ç†åä»è¶…è¿‡ 85%
**å»ºè®®ä¿®å¤**ï¼šåˆ é™¤åº”ç”¨æ—¥å¿—ã€å‹ç¼©å½’æ¡£ã€æ‰©å®¹ç£ç›˜
**é£é™©è¯„ä¼°**ï¼šæ¸…ç†æ—¥å¿—å¯èƒ½å½±å“é—®é¢˜æ’æŸ¥

### L3 - ä¸¥é‡é—®é¢˜
**è§¦å‘æ¡ä»¶**ï¼šç£ç›˜ä½¿ç”¨ç‡ > 95%ï¼Œå¯ç”¨ç©ºé—´ < 1GB
**ä¸ŠæŠ¥ä¿¡æ¯**ï¼šç«‹å³äººå·¥ä»‹å…¥
```

**LLM ç†è§£åˆ°**ï¼š
- ç›®æ ‡ï¼šç›‘æ§ç£ç›˜
- å·¥å…·ï¼š`check_disk.py`
- é˜ˆå€¼ï¼š< 80% æ­£å¸¸
- L1 æ¡ä»¶å’Œä¿®å¤æ–¹æ³•

**4.2 æ‰§è¡Œæ£€æŸ¥å·¥å…·**

```bash
python3 tools/check_disk.py
```

**å·¥å…·è¾“å‡º**ï¼ˆJSON æ ¼å¼ï¼‰ï¼š
```json
{
  "status": "ok",
  "max_usage_percent": 63.42,
  "partitions": [
    {
      "device": "/dev/sdc",
      "mount_point": "/",
      "filesystem": "ext4",
      "total_gb": 1007.87,
      "used_gb": 639.08,
      "free_gb": 317.56,
      "percent": 63.42
    }
  ],
  "large_directories": []
}
```

**4.3 LLM åˆ†æç»“æœ**

```
åˆ†æï¼š
63.42% < 80% â†’ æ­£å¸¸èŒƒå›´
æ— éœ€ä¿®å¤
çŠ¶æ€ï¼šOK
```

**4.4 å¤„ç†é—®é¢˜ï¼ˆåœºæ™¯æ¼”ç¤ºï¼‰**

**åœºæ™¯ Aï¼šL1 - ç£ç›˜ä½¿ç”¨ 85%**
```bash
# LLM è‡ªåŠ¨æ‰§è¡Œ
python3 tools/cleanup_disk.py --safe

# ç»“æœ
{
  "status": "fixed",
  "level": "L1",
  "disk_usage_before": 85.2,
  "disk_usage_after": 72.1,
  "freed_space_gb": 15.8,
  "actions": [
    "Cleaned /tmp: 8.5GB",
    "Cleaned old logs: 5.2GB",
    "Cleaned apt cache: 2.1GB"
  ]
}
```

**åœºæ™¯ Bï¼šL2 - ç£ç›˜ä½¿ç”¨ 92%**
```json
{
  "level": "L2",
  "type": "disk_space_high",
  "severity": "high",
  "description": "Disk usage at 92%, need decision",
  "proposed_fix": "Archive or delete old application logs (30+ days)",
  "risk_assessment": "Low - logs older than 30 days rarely needed",
  "details": {
    "large_log_files": {
      "/var/log/app/app.log": "12GB"
    }
  }
}
```
â†’ è®°å½•åˆ° issues åˆ—è¡¨ï¼Œä¸ŠæŠ¥ç»™ Monitor

**åœºæ™¯ Cï¼šL3 - ç£ç›˜ä½¿ç”¨ 97%**
```json
{
  "level": "L3",
  "severity": "critical",
  "description": "Disk almost full at 97%, immediate intervention required",
  "available_space_mb": 512,
  "recommendation": "Manually free space or add disk"
}
```
â†’ è®°å½•ä¸ºä¸¥é‡å‘Šè­¦ï¼Œè§¦å‘äººå·¥é€šçŸ¥

---

### æ­¥éª¤ 5ï¼šç”ŸæˆæŠ¥å‘Š

**è°ƒç”¨æŠ¥å‘Šæ„å»ºå™¨**ï¼š
```bash
python3 tools/report_builder.py \
  --disk disk_result.json \
  --memory memory_result.json \
  --cpu cpu_result.json \
  --services services_result.json \
  -o output/report.json
```

**report_builder.py çš„é€»è¾‘**ï¼š
1. èšåˆæ‰€æœ‰æ£€æŸ¥ç»“æœçš„æŒ‡æ ‡
2. æ”¶é›†æ‰€æœ‰å‘ç°çš„é—®é¢˜ï¼ˆL1/L2/L3ï¼‰
3. æ”¶é›†æ‰€æœ‰æ‰§è¡Œçš„ä¿®å¤åŠ¨ä½œ
4. ç¡®å®šæ•´ä½“çŠ¶æ€ï¼š
   ```python
   if any L3 issues:
       status = "critical"
   elif any L2 issues:
       status = "warning"
   else:
       status = "healthy"
   ```
5. ç”Ÿæˆç¬¦åˆ Monitor API çš„æ ‡å‡† JSON

**æœ€ç»ˆæŠ¥å‘Š**ï¼š
```json
{
  "agent_id": "agent-prod-001",
  "timestamp": "2025-11-16T10:34:55.367389+00:00",
  "status": "healthy",
  "metrics": {
    "disk_percent": 63.42,
    "memory_percent": 22.06,
    "cpu_percent": 0.86
  },
  "issues": [],
  "actions_taken": []
}
```

---

### æ­¥éª¤ 6ï¼šä¸ŠæŠ¥åˆ° Monitor

**è°ƒç”¨ä¸ŠæŠ¥å·¥å…·**ï¼š
```bash
python3 tools/report_to_monitor.py output/report.json
```

**HTTP è¯·æ±‚**ï¼š
```http
POST http://monitor.example.com:8000/api/reports
Content-Type: application/json
X-API-Key: your-api-key

{
  "agent_id": "agent-prod-001",
  "timestamp": "2025-11-16T10:34:55.367389+00:00",
  "status": "healthy",
  "metrics": {...},
  "issues": [],
  "actions_taken": []
}
```

---

### æ­¥éª¤ 7ï¼šMonitor å¤„ç†

**Monitor API å¤„ç†æµç¨‹**ï¼š

```python
@router.post("/reports")
async def receive_report(report: ProbeReport):
    # 1. å­˜å‚¨æŠ¥å‘Šåˆ°æ•°æ®åº“
    db_report = Report(...)
    session.add(db_report)

    # 2. æ›´æ–° Agent å¿ƒè·³
    agent.last_heartbeat = datetime.utcnow()

    # 3. å¤„ç† L2 å†³ç­–è¯·æ±‚
    l2_issues = [i for i in report.issues if i.level == "L2"]
    if l2_issues:
        decision_engine = DecisionEngine()
        decisions = await decision_engine.batch_analyze(l2_issues)
        # LLM åˆ†æé£é™©ï¼Œå†³å®šæ‰¹å‡†/æ‹’ç»

    # 4. å¤„ç† L3 å‘Šè­¦
    l3_issues = [i for i in report.issues if i.level == "L3"]
    if l3_issues:
        alert_aggregator = AlertAggregator()
        alerts = await alert_aggregator.process_issues(l3_issues)
        # å‘é€ Telegram é€šçŸ¥

    # 5. è¿”å›å“åº”
    return {
        "success": True,
        "data": {
            "report_id": db_report.id,
            "l2_decisions": [...],
            "l3_alerts_triggered": len(alerts)
        }
    }
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "report_id": 123,
    "l2_decisions": [
      {
        "decision_id": 456,
        "issue_type": "high_memory",
        "status": "approved",
        "reason": "Safe to restart - traffic is low"
      }
    ],
    "l3_alerts_triggered": 0
  }
}
```

---

## æ ¸å¿ƒè®¾è®¡åŸç†

### 1. æ–‡æ¡£é©±åŠ¨ vs ä»£ç é©±åŠ¨

#### æ—§æ–¹å¼ï¼ˆä»£ç é©±åŠ¨ï¼‰
```python
def check_disk():
    usage = get_disk_usage()
    if usage > 90:
        return Issue(level="L3", description="Disk critical")
    elif usage > 80:
        cleanup_tmp()
        return Issue(level="L1", description="Cleaned temp files")
    else:
        return OK
```

**é—®é¢˜**ï¼š
- âŒ éœ€è¦ç¼–ç¨‹çŸ¥è¯†ä¿®æ”¹
- âŒ é€»è¾‘ç¡¬ç¼–ç ï¼Œéš¾ä»¥è°ƒæ•´
- âŒ é˜ˆå€¼ä¿®æ”¹éœ€è¦é‡æ–°éƒ¨ç½²

#### æ–°æ–¹å¼ï¼ˆæ–‡æ¡£é©±åŠ¨ï¼‰
```markdown
# disk_space.md

## L1 - å¯è‡ªåŠ¨ä¿®å¤
**è§¦å‘æ¡ä»¶**ï¼šç£ç›˜ä½¿ç”¨ç‡ 80-90%
**ä¿®å¤æ–¹æ³•**ï¼šæ¸…ç†ä¸´æ—¶æ–‡ä»¶

## L3 - ä¸¥é‡é—®é¢˜
**è§¦å‘æ¡ä»¶**ï¼šç£ç›˜ä½¿ç”¨ç‡ > 90%
```

**ä¼˜åŠ¿**ï¼š
- âœ… è¿ç»´äººå‘˜å¯è¯»å†™ï¼ˆæ— éœ€ç¼–ç¨‹ï¼‰
- âœ… é€»è¾‘æ¸…æ™°ã€æ˜“äºå®¡è®¡
- âœ… ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€é‡æ–°ç¼–è¯‘ï¼‰
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½

---

### 2. LLM ä½œä¸ºæ‰§è¡Œå¼•æ“

```
æ–‡æ¡£ (What to do) + LLM (How to do) = æ™ºèƒ½å·¡æ£€
```

**LLM çš„èƒ½åŠ›**ï¼š
- ğŸ“– ç†è§£è‡ªç„¶è¯­è¨€çš„å·¡æ£€è¦æ±‚
- ğŸ”§ è°ƒç”¨åˆé€‚çš„å·¥å…·
- ğŸ§  åˆ†æå·¥å…·è¾“å‡º
- âš–ï¸ åˆ¤æ–­é—®é¢˜çº§åˆ«
- ğŸ“Š ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š

**å·¥å…·è„šæœ¬çš„èŒè´£**ï¼š
- ğŸ“¡ åªè´Ÿè´£æ•°æ®é‡‡é›†
- ğŸ“„ è¾“å‡ºæ ‡å‡† JSON
- ğŸš« ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

**èŒè´£åˆ†ç¦»**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡æ¡£å®šä¹‰     â”‚  â†’   â”‚  LLM ç†è§£     â”‚  â†’   â”‚  å·¥å…·æ‰§è¡Œ     â”‚
â”‚  What & Why  â”‚      â”‚  How          â”‚      â”‚  Data Only    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. ä¸‰çº§åˆ†ç±»ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å‘ç°é—®é¢˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
         åˆ¤æ–­é—®é¢˜çº§åˆ«
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚        â”‚
     L1                L2       L3
  è‡ªåŠ¨ä¿®å¤          éœ€è¦å†³ç­–   äººå·¥ä»‹å…¥
      â”‚                 â”‚        â”‚
  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Probe   â”‚      â”‚Monitor  â”‚  â”‚Human    â”‚
  â”‚æœ¬åœ°æ‰§è¡Œ â”‚      â”‚LLMå†³ç­–  â”‚  â”‚Telegram â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†çº§ç¤ºä¾‹**ï¼š

| åœºæ™¯ | çº§åˆ« | å¤„ç†æ–¹å¼ | ç¤ºä¾‹ |
|------|------|---------|------|
| ä¸´æ—¶æ–‡ä»¶å ç”¨ 5GB | L1 | Probe è‡ªåŠ¨æ¸…ç† | `rm -rf /tmp/*` |
| å†…å­˜ä½¿ç”¨ 92% | L2 | ä¸ŠæŠ¥ Monitorï¼ŒLLM å†³ç­– | "æ˜¯å¦é‡å¯ Java æœåŠ¡ï¼Ÿ" |
| æ•°æ®åº“æ— æ³•è¿æ¥ | L3 | ç«‹å³é€šçŸ¥äººç±» | Telegram å‘Šè­¦ |
| ç£ç›˜ä½¿ç”¨ 85% | L1 | æ¸…ç†æ—¥å¿— | `find /var/log -name "*.gz" -delete` |
| CPU è´Ÿè½½æŒç»­é«˜ | L2 | éœ€è¦æ‰©å®¹ï¼Ÿ | "æ·»åŠ  2 ä¸ª CPU æ ¸å¿ƒï¼Ÿ" |
| å®‰å…¨æ¼æ´æ£€æµ‹ | L3 | äººå·¥ä»‹å…¥ | CVE-2024-xxxx |

---

### 4. é›¶ä»£ç æ‰©å±•

**æ·»åŠ æ–°å·¡æ£€é¡¹çš„æ­¥éª¤**ï¼š

```bash
# 1. å¤åˆ¶æ¨¡æ¿
cd /opt/cortex/probe/inspections
cp TEMPLATE.md network.md

# 2. ç¼–è¾‘å·¡æ£€è¦æ±‚ï¼ˆçº¯æ–‡æœ¬ï¼‰
nano network.md
```

**network.md ç¤ºä¾‹**ï¼š
```markdown
# ç½‘ç»œè¿æ¥å·¡æ£€

## å·¡æ£€ç›®æ ‡
ç›‘æ§å…³é”®æœåŠ¡çš„ç½‘ç»œè¿æ¥çŠ¶æ€ï¼Œç¡®ä¿å¯¹å¤–æœåŠ¡å¯ç”¨ã€‚

## ä½¿ç”¨çš„å·¥å…·
- `tools/check_network.py` - æ£€æŸ¥ç«¯å£ç›‘å¬å’Œå¤–éƒ¨è¿é€šæ€§

## é˜ˆå€¼å®šä¹‰
- æ‰€æœ‰å…³é”®ç«¯å£éƒ½åº”å¤„äº LISTEN çŠ¶æ€
- å¤–éƒ¨å¥åº·æ£€æŸ¥ç«¯ç‚¹åº”è¿”å› 200 OK

## L1 - å¯è‡ªåŠ¨ä¿®å¤
**è§¦å‘æ¡ä»¶**ï¼šé˜²ç«å¢™è§„åˆ™å¼‚å¸¸
**ä¿®å¤æ–¹æ³•**ï¼š
```bash
ufw allow 80/tcp
ufw allow 443/tcp
```

## L2 - éœ€è¦å†³ç­–
**è§¦å‘æ¡ä»¶**ï¼šæœåŠ¡ç«¯å£æœªç›‘å¬ï¼ŒæœåŠ¡çŠ¶æ€æ­£å¸¸
**å»ºè®®ä¿®å¤**ï¼šé‡å¯æœåŠ¡æˆ–æ£€æŸ¥é…ç½®

## L3 - ä¸¥é‡é—®é¢˜
**è§¦å‘æ¡ä»¶**ï¼šDNS è§£æå¤±è´¥ã€ç½‘å…³ä¸å¯è¾¾
```

```bash
# 3. ï¼ˆå¯é€‰ï¼‰åˆ›å»ºæ£€æŸ¥å·¥å…·
nano tools/check_network.py
```

```python
#!/usr/bin/env python3
import json
import socket

def check_port(host, port):
    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.settimeout(1)
            s.connect((host, port))
            return True
    except:
        return False

result = {
    "status": "ok" if check_port("localhost", 80) else "error",
    "ports": {
        "80": check_port("localhost", 80),
        "443": check_port("localhost", 443)
    }
}
print(json.dumps(result))
```

```bash
# 4. å®Œæˆï¼ä¸‹æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæ•ˆ
sudo /opt/cortex/probe/run_probe.sh
```

**æ— éœ€**ï¼š
- âŒ ä¿®æ”¹ Python ä»£ç 
- âŒ é‡å¯æœåŠ¡
- âŒ é‡æ–°éƒ¨ç½²
- âŒ ç¼–è¯‘æˆ–æ‰“åŒ…

---

## å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šç£ç›˜ç©ºé—´é¢„è­¦å’Œè‡ªåŠ¨æ¸…ç†

**åœºæ™¯**ï¼š
- æœåŠ¡å™¨è¿è¡Œ 3 ä¸ªæœˆ
- `/var/log` å ç”¨ 15GB
- ç£ç›˜ä½¿ç”¨ç‡è¾¾åˆ° 82%

**æ‰§è¡Œè¿‡ç¨‹**ï¼š

1. **æ£€æµ‹**ï¼š
   ```bash
   $ python3 tools/check_disk.py
   {
     "status": "warning",
     "max_usage_percent": 82.3,
     "large_directories": [
       {"/var/log": "15GB"}
     ]
   }
   ```

2. **LLM åˆ†æ**ï¼š
   ```
   ç£ç›˜ä½¿ç”¨ 82.3% â†’ åœ¨ 80-90% èŒƒå›´
   å­˜åœ¨å¯æ¸…ç†çš„æ—¥å¿—æ–‡ä»¶
   ç¬¦åˆ L1 æ¡ä»¶ â†’ æ‰§è¡Œè‡ªåŠ¨ä¿®å¤
   ```

3. **è‡ªåŠ¨ä¿®å¤**ï¼š
   ```bash
   $ python3 tools/cleanup_disk.py --safe
   Cleaning /tmp: 2.1GB freed
   Cleaning old logs: 11.5GB freed
   Cleaning apt cache: 1.8GB freed
   Total freed: 15.4GB
   ```

4. **éªŒè¯**ï¼š
   ```bash
   $ python3 tools/check_disk.py
   {
     "status": "ok",
     "max_usage_percent": 67.8
   }
   ```

5. **æŠ¥å‘Š**ï¼š
   ```json
   {
     "status": "healthy",
     "actions_taken": [
       {
         "level": "L1",
         "action": "disk_cleanup",
         "result": "success",
         "details": "Freed 15.4GB"
       }
     ]
   }
   ```

**ç»“æœ**ï¼šé—®é¢˜è‡ªåŠ¨è§£å†³ï¼Œæ— éœ€äººå·¥ä»‹å…¥ã€‚

---

### æ¡ˆä¾‹ 2ï¼šå†…å­˜æ³„æ¼ - L2 å†³ç­–æµç¨‹

**åœºæ™¯**ï¼š
- Java åº”ç”¨è¿è¡Œ 48 å°æ—¶
- å†…å­˜ä½¿ç”¨ä» 60% å¢é•¿åˆ° 94%
- å­˜åœ¨å†…å­˜æ³„æ¼è¿¹è±¡

**æ‰§è¡Œè¿‡ç¨‹**ï¼š

1. **æ£€æµ‹**ï¼š
   ```bash
   $ python3 tools/check_memory.py
   {
     "status": "warning",
     "memory_percent": 94.2,
     "suspected_leak": {
       "process": "java",
       "pid": 1234,
       "memory_growth_24h": "8GB"
     }
   }
   ```

2. **LLM åˆ†æ**ï¼š
   ```
   å†…å­˜ä½¿ç”¨ 94.2% â†’ è¶…è¿‡ 90% é˜ˆå€¼
   æ£€æµ‹åˆ°å†…å­˜æ³„æ¼ï¼ˆ24å°æ—¶å¢é•¿ 8GBï¼‰
   L1 æ¸…ç†ï¼ˆdrop cacheï¼‰æ•ˆæœæœ‰é™
   ç¬¦åˆ L2 æ¡ä»¶ â†’ éœ€è¦ Monitor å†³ç­–
   ```

3. **ä¸ŠæŠ¥ L2 é—®é¢˜**ï¼š
   ```json
   {
     "level": "L2",
     "type": "memory_leak",
     "severity": "high",
     "description": "Java process memory leak detected, 94.2% usage",
     "proposed_fix": "Restart Java application (PID 1234)",
     "risk_assessment": "Medium - 30s downtime, active sessions will be lost",
     "details": {
       "process": "java",
       "pid": 1234,
       "memory_mb": 14500,
       "memory_growth_24h": 8192
     }
   }
   ```

4. **Monitor LLM å†³ç­–**ï¼š
   ```python
   # Monitor çš„ DecisionEngine
   decision = await llm.analyze(
       issue=l2_issue,
       context={
           "time": "03:15 AM",  # ä½æµé‡æ—¶æ®µ
           "traffic": "12 requests/min",  # å½“å‰æµé‡
           "uptime": "48 hours"
       }
   )

   # LLM è¾“å‡º
   {
       "status": "approved",
       "reason": "Low traffic period (3 AM), minimal impact. "
                 "Memory leak will worsen if not addressed.",
       "recommended_action": "restart_service",
       "estimated_downtime": "30s"
   }
   ```

5. **æ‰§è¡Œä¿®å¤**ï¼ˆProbe æ”¶åˆ°æ‰¹å‡†åï¼‰ï¼š
   ```bash
   $ systemctl restart java-app
   $ python3 tools/check_memory.py
   {
     "status": "ok",
     "memory_percent": 45.3
   }
   ```

**ç»“æœ**ï¼šé€šè¿‡ LLM å†³ç­–ï¼Œåœ¨ä½æµé‡æ—¶æ®µè‡ªåŠ¨é‡å¯ï¼Œé—®é¢˜è§£å†³ã€‚

---

### æ¡ˆä¾‹ 3ï¼šæ•°æ®åº“æ•…éšœ - L3 å‘Šè­¦æµç¨‹

**åœºæ™¯**ï¼š
- PostgreSQL æ•°æ®åº“æ— æ³•è¿æ¥
- åº”ç”¨æœåŠ¡å—å½±å“
- éœ€è¦ç«‹å³äººå·¥ä»‹å…¥

**æ‰§è¡Œè¿‡ç¨‹**ï¼š

1. **æ£€æµ‹**ï¼š
   ```bash
   $ python3 tools/check_services.py
   {
     "status": "critical",
     "failed_services": ["postgresql"],
     "error": "Connection refused"
   }
   ```

2. **LLM åˆ†æ**ï¼š
   ```
   å…³é”®æœåŠ¡ postgresql å¤±è´¥
   å°è¯•é‡å¯ï¼šå¤±è´¥
   ç¬¦åˆ L3 æ¡ä»¶ â†’ ä¸¥é‡å‘Šè­¦
   ```

3. **ä¸ŠæŠ¥ L3 å‘Šè­¦**ï¼š
   ```json
   {
     "level": "L3",
     "severity": "critical",
     "type": "database_down",
     "description": "PostgreSQL database is down and cannot be auto-recovered",
     "details": {
       "service": "postgresql",
       "restart_attempts": 3,
       "last_error": "FATAL: data directory corruption detected",
       "affected_apps": ["web-app", "api-service"]
     },
     "recommendation": "Check data directory integrity, may need manual recovery"
   }
   ```

4. **Monitor å¤„ç†**ï¼š
   ```python
   # å‘é€ Telegram é€šçŸ¥
   await telegram_notifier.send_alert(
       level="CRITICAL",
       title="ğŸš¨ Database Down - agent-prod-001",
       message="PostgreSQL is down. Data corruption suspected.\n"
               "Affected: web-app, api-service\n"
               "Action: Manual recovery required"
   )
   ```

5. **äººå·¥ä»‹å…¥**ï¼š
   - è¿ç»´äººå‘˜æ”¶åˆ° Telegram é€šçŸ¥
   - ç™»å½•æœåŠ¡å™¨æ£€æŸ¥æ•°æ®ç›®å½•
   - æ‰§è¡Œæ•°æ®åº“ä¿®å¤
   - æ¢å¤æœåŠ¡

**ç»“æœ**ï¼šå¿«é€Ÿé€šçŸ¥åˆ°äººï¼Œæœ€å°åŒ–æ•…éšœæ—¶é—´ã€‚

---

## ä¸ä¼ ç»Ÿç›‘æ§å¯¹æ¯”

### åŠŸèƒ½å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿç›‘æ§<br/>(Nagios/Zabbix/Prometheus) | Cortex Probe |
|------|---------------------------------------|--------------|
| **é…ç½®æ–¹å¼** | é…ç½®æ–‡ä»¶ + Perl/Python è„šæœ¬ | Markdown æ–‡æ¡£ |
| **æ‰©å±•éš¾åº¦** | éœ€è¦ç¼–ç¨‹ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­ | æ–‡æœ¬ç¼–è¾‘ï¼Œ5åˆ†é’Ÿä¸Šæ‰‹ |
| **å†³ç­–èƒ½åŠ›** | å›ºå®šé˜ˆå€¼ï¼Œif-else é€»è¾‘ | LLM æ™ºèƒ½åˆ†æä¸Šä¸‹æ–‡ |
| **è‡ªåŠ¨ä¿®å¤** | æœ‰é™æ”¯æŒï¼Œéœ€è¦å¤æ‚é…ç½® | L1 è‡ªåŠ¨ + L2 å†³ç­– + L3 å‘Šè­¦ |
| **å¯è¯»æ€§** | éœ€è¦æŠ€æœ¯èƒŒæ™¯ç†è§£ | è¿ç»´äººå‘˜ç›´æ¥é˜…è¯» |
| **éƒ¨ç½²æˆæœ¬** | å¤æ‚ï¼Œå¤šä¸ªç»„ä»¶ | `install.sh` ä¸€é”®å®Œæˆ |
| **é—®é¢˜å…³è”** | éœ€è¦æ‰‹åŠ¨é…ç½®è§„åˆ™ | LLM è‡ªåŠ¨ç†è§£ä¸Šä¸‹æ–‡ |
| **è¯¯æŠ¥ç‡** | é«˜ï¼ˆå›ºå®šé˜ˆå€¼ï¼‰ | ä½ï¼ˆæ™ºèƒ½åˆ¤æ–­ï¼‰ |
| **æ–‡æ¡£åŒ–** | é…ç½®å³æ–‡æ¡£ï¼Ÿ | æ–‡æ¡£å³é…ç½® |

### å®é™…åœºæ™¯å¯¹æ¯”

#### åœºæ™¯ï¼šCPU ä½¿ç”¨ç‡ 90%

**Nagios æ–¹å¼**ï¼š
```cfg
# nrpe.cfg
command[check_cpu]=/usr/lib/nagios/plugins/check_cpu -w 70 -c 90

# è§¦å‘å‘Šè­¦
WARNING - CPU usage is 90%
```
**é—®é¢˜**ï¼š
- âŒ æ— æ³•åŒºåˆ†æ˜¯å¤‡ä»½ä»»åŠ¡è¿˜æ˜¯å¼‚å¸¸è¿›ç¨‹
- âŒ ä¸çŸ¥é“å¦‚ä½•å¤„ç†
- âŒ éœ€è¦äººå·¥åˆ†æå’Œå†³ç­–

**Cortex Probe æ–¹å¼**ï¼š
```markdown
# cpu.md

## L1 - å¯è‡ªåŠ¨ä¿®å¤
**è§¦å‘æ¡ä»¶**ï¼šCPU 70-85%ï¼Œå­˜åœ¨å·²çŸ¥çš„åå°ä»»åŠ¡
**ä¿®å¤æ–¹æ³•**ï¼šé™ä½åå°ä»»åŠ¡ä¼˜å…ˆçº§
```

**LLM æ‰§è¡Œ**ï¼š
```python
# æ£€æŸ¥ CPU ä½¿ç”¨æƒ…å†µ
cpu_result = check_cpu()
# åˆ†æè¿›ç¨‹åˆ—è¡¨
processes = get_top_processes()

if processes.has_process("backup_script"):
    # L1: å·²çŸ¥çš„å¤‡ä»½ä»»åŠ¡ï¼Œé™ä½ä¼˜å…ˆçº§
    renice(process="backup_script", priority=10)
    status = "L1_fixed"
elif processes.has_process("unknown_crypto_miner"):
    # L3: æœªçŸ¥çš„é«˜ CPU è¿›ç¨‹ï¼Œå¯èƒ½æ˜¯å®‰å…¨é—®é¢˜
    status = "L3_alert"
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç†è§£ä¸Šä¸‹æ–‡ï¼ˆå¤‡ä»½ vs æŒ–çŸ¿ï¼‰
- âœ… è‡ªåŠ¨å¤„ç†å·²çŸ¥åœºæ™¯
- âœ… å‘Šè­¦æœªçŸ¥å¨èƒ

---

### æˆæœ¬å¯¹æ¯”

#### ä¼ ç»Ÿç›‘æ§ï¼ˆZabbixï¼‰

**åˆå§‹æˆæœ¬**ï¼š
```
æœåŠ¡å™¨å®‰è£…ï¼š2 å°æ—¶
é…ç½®æ•°æ®åº“ï¼š1 å°æ—¶
ç¼–å†™ç›‘æ§è„šæœ¬ï¼š8 å°æ—¶/é¡¹ï¼ˆ4 é¡¹ = 32 å°æ—¶ï¼‰
é…ç½®å‘Šè­¦è§„åˆ™ï¼š4 å°æ—¶
é…ç½®è‡ªåŠ¨ä¿®å¤ï¼š8 å°æ—¶
æ€»è®¡ï¼š47 å°æ—¶
```

**ç»´æŠ¤æˆæœ¬**ï¼š
```
æ–°å¢ç›‘æ§é¡¹ï¼š6 å°æ—¶/é¡¹
ä¿®æ”¹é˜ˆå€¼ï¼šéœ€è¦é‡å¯æœåŠ¡
è°ƒè¯•è„šæœ¬ï¼š2 å°æ—¶/æ¬¡
```

#### Cortex Probe

**åˆå§‹æˆæœ¬**ï¼š
```
è¿è¡Œ install.shï¼š5 åˆ†é’Ÿ
ç¼–è¾‘ config.yamlï¼š10 åˆ†é’Ÿ
æµ‹è¯•è¿è¡Œï¼š5 åˆ†é’Ÿ
æ€»è®¡ï¼š20 åˆ†é’Ÿ
```

**ç»´æŠ¤æˆæœ¬**ï¼š
```
æ–°å¢å·¡æ£€é¡¹ï¼š5 åˆ†é’Ÿï¼ˆå¤åˆ¶æ¨¡æ¿ + ç¼–è¾‘æ–‡æ¡£ï¼‰
ä¿®æ”¹é˜ˆå€¼ï¼š30 ç§’ï¼ˆç¼–è¾‘ Markdownï¼‰
æ— éœ€é‡å¯ï¼šç«‹å³ç”Ÿæ•ˆ
```

**ROI**ï¼š
```
ä¼ ç»Ÿç›‘æ§ï¼š47 å°æ—¶åˆå§‹ + 6 å°æ—¶/é¡¹ç»´æŠ¤
Cortex Probeï¼š0.3 å°æ—¶åˆå§‹ + 0.08 å°æ—¶/é¡¹ç»´æŠ¤

èŠ‚çœï¼š99% åˆå§‹æˆæœ¬ + 98% ç»´æŠ¤æˆæœ¬
```

---

## æ€»ç»“

### Probe çš„æ ¸å¿ƒä»·å€¼

1. **ğŸ“„ æ–‡æ¡£å³ä»£ç **
   - è¿ç»´çŸ¥è¯†ä»¥ Markdown å½¢å¼ä¿å­˜
   - å¯è¯»ã€å¯ç‰ˆæœ¬æ§åˆ¶ã€å¯å®¡è®¡
   - é™ä½ç»´æŠ¤æˆæœ¬ 99%

2. **ğŸ¤– LLM é©±åŠ¨**
   - æ™ºèƒ½ç†è§£ä¸Šä¸‹æ–‡å’Œæ„å›¾
   - è‡ªä¸»æ‰§è¡Œå’Œå†³ç­–
   - å‡å°‘è¯¯æŠ¥ 80%+

3. **ğŸ”§ è‡ªåŠ¨ä¿®å¤**
   - L1 é—®é¢˜é›¶äººå·¥å¹²é¢„
   - L2 æ™ºèƒ½å†³ç­–è¾…åŠ©
   - L3 ç²¾å‡†å‘Šè­¦

4. **ğŸ¯ æ™ºèƒ½åˆ†çº§**
   - ä¸æ˜¯ç¡¬ç¼–ç è§„åˆ™
   - æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€åˆ¤æ–­
   - é™ä½äººå·¥ä»‹å…¥ 70%

5. **ğŸš€ æ˜“äºæ‰©å±•**
   - é›¶ç¼–ç¨‹æ·»åŠ æ–°å·¡æ£€é¡¹
   - 5 åˆ†é’Ÿä»åˆ›æ„åˆ°ç”Ÿäº§
   - è¿ç»´äººå‘˜ç›´æ¥æ“ä½œ

### é€‚ç”¨åœºæ™¯

âœ… **é€‚åˆ**ï¼š
- ä¸­å°è§„æ¨¡åŸºç¡€è®¾æ–½ï¼ˆ10-1000 å°æœåŠ¡å™¨ï¼‰
- é‡å¤æ€§è¿ç»´ä»»åŠ¡å¤š
- å›¢é˜ŸæŠ€æœ¯æ ˆå¤šæ ·åŒ–
- éœ€è¦å¿«é€Ÿè¿­ä»£å·¡æ£€ç­–ç•¥

âŒ **ä¸é€‚åˆ**ï¼š
- æ¯«ç§’çº§ç›‘æ§éœ€æ±‚ï¼ˆå®æ—¶æ€§è¦æ±‚æé«˜ï¼‰
- å®Œå…¨ç¦»çº¿ç¯å¢ƒï¼ˆéœ€è¦ Claude APIï¼‰
- æ³•è§„ç¦æ­¢ AI å†³ç­–çš„åœºæ™¯

### ä¸‹ä¸€æ­¥

1. **éƒ¨ç½²æµ‹è¯•**
   ```bash
   cd probe_workspace
   sudo ./install.sh
   sudo /opt/cortex/probe/run_probe.sh
   ```

2. **æ·»åŠ è‡ªå®šä¹‰å·¡æ£€**
   ```bash
   cd /opt/cortex/probe/inspections
   cp TEMPLATE.md my_custom_check.md
   nano my_custom_check.md
   ```

3. **é›†æˆåˆ° Monitor**
   ```yaml
   # /etc/cortex/config.yaml
   agent:
     upstream_monitor_url: "http://your-monitor:8000"
   ```

4. **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**
   - [Probe ä½¿ç”¨æ‰‹å†Œ](../probe_workspace/README.md)
   - [æ·»åŠ å·¡æ£€é¡¹æ•™ç¨‹](../probe_workspace/inspections/TEMPLATE.md)
   - [æ•…éšœæ’æŸ¥æŒ‡å—](troubleshooting.md)

---

**Probe çš„æœ¬è´¨æ˜¯å°†è¿ç»´çŸ¥è¯†æ–‡æ¡£åŒ–ã€æ™ºèƒ½åŒ–ã€è‡ªåŠ¨åŒ–ã€‚è¿™ä¸ä»…æ˜¯ä¸€ä¸ªç›‘æ§å·¥å…·ï¼Œæ›´æ˜¯ä¸€ç§æ–°çš„è¿ç»´èŒƒå¼ã€‚**
